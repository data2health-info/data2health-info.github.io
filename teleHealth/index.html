<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telemedicine Portal - UI Mockup with Gemini AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .sidebar-link.active {
            background-color: #4A90E2;
            color: white;
        }
        .sidebar-link.active svg {
            stroke: white;
        }
        .tab-link.active, .pc-tab-link.active {
            border-bottom-color: #4A90E2;
            color: #4A90E2;
            font-weight: 500;
        }
        .gemini-btn {
            background: linear-gradient(to right, #4A90E2, #50E3C2);
            color: white;
            transition: all 0.3s ease;
        }
        .gemini-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .loader {
            border: 4px solid rgba(0, 0, 0, .1);
            border-left-color: #4A90E2;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div id="app-container" class="flex h-screen">
        <!-- Sidebar -->
        <aside id="sidebar" class="w-64 bg-white shadow-md flex flex-col">
            <div class="p-6 text-2xl font-bold text-blue-600 border-b">
                TeleHealth+
            </div>
            <nav id="parent-nav" class="flex-1 p-4 space-y-2">
                <a href="#parent-dashboard" class="sidebar-link flex items-center p-3 rounded-lg hover:bg-gray-200 transition-colors duration-200 active">
                    <i data-feather="home" class="mr-3"></i> Dashboard
                </a>
                <a href="#child-health" class="sidebar-link flex items-center p-3 rounded-lg hover:bg-gray-200 transition-colors duration-200">
                    <i data-feather="heart" class="mr-3"></i> My Child's Health
                </a>
                <a href="#appointments" class="sidebar-link flex items-center p-3 rounded-lg hover:bg-gray-200 transition-colors duration-200">
                    <i data-feather="calendar" class="mr-3"></i> Appointments
                </a>
                <a href="#messaging" class="sidebar-link flex items-center p-3 rounded-lg hover:bg-gray-200 transition-colors duration-200">
                    <i data-feather="message-square" class="mr-3"></i> Secure Messaging
                </a>
            </nav>
            <nav id="provider-nav" class="flex-1 p-4 space-y-2 hidden">
                 <a href="#provider-dashboard" class="sidebar-link flex items-center p-3 rounded-lg hover:bg-gray-200 transition-colors duration-200">
                    <i data-feather="grid" class="mr-3"></i> Dashboard
                </a>
                <a href="#patient-context" class="sidebar-link flex items-center p-3 rounded-lg hover:bg-gray-200 transition-colors duration-200">
                    <i data-feather="user" class="mr-3"></i> Patient Context
                </a>
                <a href="#schedule-management" class="sidebar-link flex items-center p-3 rounded-lg hover:bg-gray-200 transition-colors duration-200">
                    <i data-feather="calendar" class="mr-3"></i> Schedule
                </a>
            </nav>
            <div class="p-4 border-t">
                <div class="flex items-center">
                     <span class="text-sm font-medium">Switch View:</span>
                     <button id="switch-view-btn" class="ml-auto bg-blue-500 text-white text-xs px-2 py-1 rounded-md">Switch to Provider</button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col">
            <!-- Header -->
            <header class="bg-white shadow-sm p-4 flex items-center justify-between z-20">
                <h1 id="header-title" class="text-xl font-bold">Welcome, Sarah Miller</h1>
                <div class="flex items-center">
                    <div id="child-switcher" class="relative">
                        <select class="appearance-none bg-gray-100 border border-gray-300 rounded-md py-2 px-4 pr-8 leading-tight focus:outline-none focus:bg-white focus:border-blue-500">
                            <option>Liam (Age 5)</option>
                            <option>Chloe (Age 2)</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                            <i data-feather="chevron-down" class="h-4 w-4"></i>
                        </div>
                    </div>
                    <div id="provider-search" class="relative hidden">
                        <input type="text" placeholder="Search Patients..." class="bg-gray-100 border border-gray-300 rounded-md py-2 px-4 pl-10 focus:outline-none focus:bg-white focus:border-blue-500">
                        <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3 text-gray-700">
                            <i data-feather="search" class="h-4 w-4"></i>
                        </div>
                    </div>
                    <div class="ml-6">
                        <img src="https://placehold.co/40x40/4A90E2/FFFFFF?text=SM" id="user-avatar" class="rounded-full" alt="User Avatar">
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <div class="flex-1 p-8 overflow-y-auto bg-[#F7F9FC]">
                <!-- Parent Views -->
                <div id="parent-dashboard" class="view">
                    <!-- Parent Dashboard content -->
                </div>

                <div id="child-health" class="view hidden">
                    <h2 class="text-2xl font-bold mb-4">Liam's Health</h2>
                    <div class="border-b border-gray-300 mb-6">
                        <nav class="flex space-x-8 -mb-px" aria-label="Tabs">
                            <a href="#" class="tab-link whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="timeline">Timeline</a>
                            <a href="#" class="tab-link active whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="records">Health Records</a>
                            <a href="#" class="tab-link whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="vitals">Track Vitals</a>
                            <a href="#" class="tab-link whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="library">Health Library</a>
                        </nav>
                    </div>
                    <div id="timeline" class="tab-content hidden">... Timeline Content ...</div>
                    <div id="records" class="tab-content">
                        <div class="bg-white p-6 rounded-lg shadow">
                            <div class="flex justify-between items-start mb-6">
                                <div>
                                    <h3 class="font-bold text-lg">Health Records Summary</h3>
                                    <p class="text-sm text-gray-500">A read-only summary of Liam's key health information.</p>
                                </div>
                                <button id="ask-gemini-parent-btn" class="gemini-btn font-semibold py-2 px-4 rounded-lg flex items-center">
                                    <span class="mr-2">âœ¨</span> Ask AI Assistant
                                </button>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div id="health-conditions">
                                    <h4 class="font-semibold text-gray-700 mb-2">Conditions</h4>
                                    <ul class="list-disc list-inside text-gray-600 space-y-1">
                                        <li>Asthma</li>
                                        <li>Eczema</li>
                                    </ul>
                                </div>
                                <div id="health-allergies">
                                    <h4 class="font-semibold text-gray-700 mb-2">Allergies & Intolerances</h4>
                                    <ul class="list-disc list-inside text-gray-600 space-y-1">
                                        <li>Peanuts (Anaphylaxis)</li>
                                    </ul>
                                </div>
                                <div id="health-medications">
                                    <h4 class="font-semibold text-gray-700 mb-2">Medications</h4>
                                    <ul class="list-disc list-inside text-gray-600 space-y-1">
                                        <li>Albuterol Inhaler (as-needed)</li>
                                        <li>Fluticasone Propionate (daily)</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="vitals" class="tab-content hidden">... Track Vitals Content ...</div>
                    <div id="library" class="tab-content hidden">... Health Library Content ...</div>
                </div>

                <div id="appointments" class="view hidden">
                     <!-- Appointments content -->
                </div>

                <div id="messaging" class="view hidden h-full">
                    <!-- Messaging content -->
                </div>
                
                <div id="video-call" class="view hidden"></div>

                <!-- Provider Views -->
                <div id="provider-dashboard" class="view hidden">
                    <!-- Provider Dashboard content -->
                </div>
                <div id="patient-context" class="view hidden">
                    <!-- Sticky Header / Patient Banner -->
                    <div class="bg-white p-4 rounded-lg shadow-sm mb-6 sticky top-0 z-10">
                        <div class="flex justify-between items-center">
                            <div>
                                <h2 class="text-2xl font-bold">Liam Miller</h2>
                                <p class="text-gray-500">Age 5 (DOB: 2020-05-15) | MRN: 123456</p>
                                <div class="mt-2">
                                    <span class="inline-block bg-red-100 text-red-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">Allergies: Peanuts</span>
                                </div>
                            </div>
                            <div class="relative">
                                <button class="bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg flex items-center hover:bg-blue-600">
                                    <i data-feather="plus" class="mr-2 h-5 w-5"></i> New
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Tabbed Navigation -->
                    <div class="border-b border-gray-300 mb-6">
                        <nav class="flex space-x-8 -mb-px" aria-label="Patient Context Tabs">
                            <a href="#" class="pc-tab-link whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="pc-summary">Chart Summary</a>
                            <a href="#" class="pc-tab-link whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="pc-growth">Growth Chart</a>
                            <a href="#" class="pc-tab-link whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="pc-family">Family History</a>
                            <a href="#" class="pc-tab-link active whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="pc-notes">Encounters & Notes</a>
                            <a href="#" class="pc-tab-link whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="pc-messaging">Messaging</a>
                        </nav>
                    </div>

                    <!-- Tab Content -->
                    <div id="pc-summary" class="pc-tab-content hidden">... Chart Summary Content ...</div>
                    <div id="pc-growth" class="pc-tab-content hidden">
                        <div class="bg-white p-6 rounded-lg shadow">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="font-bold text-lg">Growth Charts</h3>
                                <div class="flex space-x-2">
                                    <select class="text-sm bg-gray-100 border border-gray-300 rounded-md py-1 px-2 focus:outline-none focus:border-blue-500">
                                        <option>Weight-for-age</option>
                                        <option>Height-for-age</option>
                                    </select>
                                    <button class="text-sm text-gray-600 hover:text-blue-500"><i data-feather="printer" class="inline-block mr-1 h-4 w-4"></i> Print</button>
                                </div>
                            </div>
                            <div class="w-full h-96 bg-gray-50 rounded-md flex items-center justify-center border">
                                <img src="https://placehold.co/800x400/F7F9FC/495057?text=Growth+Chart+Visualization" alt="Placeholder for growth chart" class="w-full h-full object-contain rounded-md"/>
                            </div>
                        </div>
                    </div>
                    <div id="pc-family" class="pc-tab-content hidden">
                        <div class="bg-white p-6 rounded-lg shadow">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="font-bold text-lg">Family Medical History</h3>
                                <button class="text-sm bg-blue-100 text-blue-700 font-semibold py-1 px-3 rounded-lg hover:bg-blue-200">
                                    <i data-feather="edit-2" class="inline-block mr-1 h-4 w-4"></i> Edit History
                                </button>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="border p-4 rounded-lg bg-gray-50">
                                    <h4 class="font-semibold">Maternal Side</h4>
                                    <ul class="list-disc list-inside text-gray-700 mt-2 space-y-1 text-sm">
                                        <li><span class="font-medium">Mother:</span> Migraines</li>
                                        <li><span class="font-medium">Maternal Grandmother:</span> Hypertension, Type 2 Diabetes</li>
                                    </ul>
                                </div>
                                <div class="border p-4 rounded-lg bg-gray-50">
                                    <h4 class="font-semibold">Paternal Side</h4>
                                    <ul class="list-disc list-inside text-gray-700 mt-2 space-y-1 text-sm">
                                        <li><span class="font-medium">Father:</span> Seasonal allergies</li>
                                        <li><span class="font-medium">Paternal Grandfather:</span> High Cholesterol</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="pc-notes" class="pc-tab-content">
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="font-bold text-lg mb-4">New Encounter Note</h3>
                            <textarea id="clinical-note-input" class="w-full h-48 p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" placeholder="Start typing clinical note here...">S: Parent reports child, Liam, has had a persistent cough for 3 days, worse at night. No fever. Using Albuterol inhaler 2x/day with some relief. O: Lungs clear to auscultation bilaterally. No wheezing noted at this time. Vitals stable. A: Likely viral-induced cough, possible mild asthma exacerbation. P: Continue Albuterol as needed. Advised parent to monitor for signs of respiratory distress. Follow up in 3-5 days if no improvement.</textarea>
                            <div class="mt-4 flex justify-end">
                                <button id="generate-summary-btn" class="gemini-btn font-semibold py-2 px-4 rounded-lg flex items-center">
                                    <span class="mr-2">âœ¨</span> Generate Summary
                                </button>
                            </div>
                        </div>
                        <div id="note-summary-container" class="mt-6 bg-white p-6 rounded-lg shadow hidden">
                            <h3 class="font-bold text-lg mb-4">Note Summary</h3>
                            <div id="note-summary-output" class="text-gray-700 space-y-2"></div>
                        </div>
                    </div>
                    <div id="pc-messaging" class="pc-tab-content hidden">... Messaging Content for this patient ...</div>
                </div>
                <div id="schedule-management" class="view hidden">Schedule Management View...</div>
            </div>
        </main>
    </div>

    <!-- Gemini Modal -->
    <div id="gemini-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 class="text-lg font-bold">âœ¨ AI Assistant</h3>
                <button id="close-gemini-modal" class="text-gray-500 hover:text-gray-800">&times;</button>
            </div>
            <div id="gemini-modal-content" class="p-6 overflow-y-auto">
                <!-- Content will be injected here -->
            </div>
            <div id="gemini-modal-loader" class="p-6 flex-1 flex items-center justify-center hidden">
                <div class="text-center">
                    <div class="loader mx-auto"></div>
                    <p class="mt-4 text-gray-600">Thinking...</p>
                </div>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            feather.replace();

            // --- Mock Content for Views (to keep HTML cleaner) ---
            document.getElementById('parent-dashboard').innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow"><h3 class="font-bold text-lg mb-4">Upcoming Appointment</h3><p class="text-gray-600 mb-2">Video call with Dr. Evans</p><p class="text-2xl font-semibold text-blue-600 mb-4">Tomorrow at 10:30 AM</p><button class="w-full bg-[#4A90E2] text-white py-2 rounded-lg font-semibold hover:bg-blue-600">Join Call</button><a href="#appointments" class="block text-center mt-3 text-blue-600 hover:underline">View All Appointments</a></div>
                    <div class="bg-white p-6 rounded-lg shadow"><h3 class="font-bold text-lg mb-4">New Messages</h3><p class="text-gray-600 mb-2">You have <span class="font-bold text-blue-600">2 new messages</span>.</p><div class="bg-gray-50 p-3 rounded-md border border-gray-200 mb-4"><p class="font-semibold text-sm">From Dr. Evans:</p><p class="text-gray-600 text-sm truncate">'The test results are in...'</p></div><button onclick="document.querySelector('a[href=\\'#messaging\\']').click()" class="w-full bg-gray-200 text-gray-800 py-2 rounded-lg font-semibold">Go to Messages</button></div>
                    <div class="bg-white p-6 rounded-lg shadow border-2 border-[#F5A623]"><h3 class="font-bold text-lg mb-2 text-[#F5A623]">Need Urgent Care?</h3><p class="text-gray-600 mb-4">For urgent but non-emergency concerns, connect with the next available provider.</p><button class="w-full bg-[#F5A623] text-white py-2 rounded-lg font-semibold hover:bg-orange-500">Request Urgent Tele-Triage</button></div>
                </div>`;
            
            const views = document.querySelectorAll('.view');
            const sidebarLinks = document.querySelectorAll('.sidebar-link');
            
            function navigate(hash) {
                if (!hash) hash = '#parent-dashboard';
                views.forEach(view => view.classList.toggle('hidden', '#' + view.id !== hash));
                sidebarLinks.forEach(link => link.classList.toggle('active', link.getAttribute('href') === hash));
            }

            sidebarLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    window.location.hash = e.currentTarget.getAttribute('href');
                });
            });
            
            window.addEventListener('hashchange', () => navigate(window.location.hash));
            navigate(window.location.hash || '#parent-dashboard');

            // --- Tab Navigation Logic ---
            function setupTabNavigation(linkClass, contentClass) {
                const links = document.querySelectorAll(linkClass);
                links.forEach(link => {
                    link.addEventListener('click', e => {
                        e.preventDefault();
                        const tabId = e.currentTarget.dataset.tab;
                        links.forEach(l => {
                            l.classList.remove('active', 'text-blue-600', 'border-blue-600');
                            l.classList.add('text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                        });
                        e.currentTarget.classList.add('active', 'text-blue-600', 'border-blue-600');
                        e.currentTarget.classList.remove('text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                        
                        document.querySelectorAll(contentClass).forEach(content => {
                            content.classList.toggle('hidden', content.id !== tabId);
                        });
                    });
                });
            }
            setupTabNavigation('.tab-link', '.tab-content');
            setupTabNavigation('.pc-tab-link', '.pc-tab-content');

            // --- View Switcher ---
            const switchBtn = document.getElementById('switch-view-btn');
            switchBtn.addEventListener('click', () => {
                const isProviderView = document.getElementById('provider-nav').classList.toggle('hidden');
                document.getElementById('parent-nav').classList.toggle('hidden');
                document.getElementById('child-switcher').classList.toggle('hidden');
                document.getElementById('provider-search').classList.toggle('hidden');
                
                if (isProviderView) {
                    switchBtn.textContent = 'Switch to Provider';
                    document.getElementById('header-title').textContent = 'Welcome, Sarah Miller';
                    document.getElementById('user-avatar').src = "https://placehold.co/40x40/4A90E2/FFFFFF?text=SM";
                    window.location.hash = '#parent-dashboard';
                } else {
                    switchBtn.textContent = 'Switch to Parent';
                    document.getElementById('header-title').textContent = 'Welcome, Dr. Evans';
                    document.getElementById('user-avatar').src = "https://placehold.co/40x40/50E3C2/FFFFFF?text=DE";
                    window.location.hash = '#provider-dashboard';
                }
                navigate(window.location.hash);
            });

            // --- Gemini API Integration ---
            const geminiModal = document.getElementById('gemini-modal');
            const geminiModalContent = document.getElementById('gemini-modal-content');
            const geminiModalLoader = document.getElementById('gemini-modal-loader');
            const closeGeminiModalBtn = document.getElementById('close-gemini-modal');

            // Generic function to call Gemini API
            async function callGemini(prompt) {
                const apiKey = ""; // Leave empty, handled by environment
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                
                const payload = {
                    contents: [{ role: "user", parts: [{ text: prompt }] }]
                };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`API Error: ${response.statusText}`);
                    }

                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0) {
                        return result.candidates[0].content.parts[0].text;
                    } else {
                        return "Sorry, I couldn't get a response. Please try again.";
                    }
                } catch (error) {
                    console.error("Gemini API call failed:", error);
                    return `An error occurred: ${error.message}. Check the console for details.`;
                }
            }
            
            // --- Parent "Ask AI" Feature ---
            const askGeminiParentBtn = document.getElementById('ask-gemini-parent-btn');
            
            askGeminiParentBtn.addEventListener('click', () => {
                geminiModalContent.innerHTML = `
                    <p class="text-gray-600 mb-4">You can ask questions about Liam's listed conditions and medications. For example: "What are the common side effects of Albuterol?"</p>
                    <textarea id="parent-question-input" class="w-full h-24 p-3 border border-gray-300 rounded-md" placeholder="Type your question here..."></textarea>
                    <div class="mt-4 text-right">
                        <button id="submit-parent-question" class="gemini-btn font-semibold py-2 px-4 rounded-lg">Ask Question</button>
                    </div>
                    <div id="parent-answer-container" class="mt-6 hidden">
                        <h4 class="font-bold text-lg mb-2">Answer:</h4>
                        <div id="parent-answer-output" class="prose max-w-none text-gray-700 bg-gray-50 p-4 rounded-md"></div>
                    </div>
                    <p class="text-xs text-gray-400 mt-4">Disclaimer: This AI assistant provides information for educational purposes only and is not a substitute for professional medical advice. Always consult with your healthcare provider.</p>
                `;
                geminiModal.classList.remove('hidden');
                
                document.getElementById('submit-parent-question').addEventListener('click', async () => {
                    const question = document.getElementById('parent-question-input').value;
                    if (!question) return;

                    const conditions = document.getElementById('health-conditions').innerText;
                    const allergies = document.getElementById('health-allergies').innerText;
                    const medications = document.getElementById('health-medications').innerText;
                    const healthData = `Patient Data:\n${conditions}\n${allergies}\n${medications}`;

                    const prompt = `You are a helpful medical information assistant for a parent. Based on the following patient health summary, answer the parent's question in simple, easy-to-understand language. Do not provide a diagnosis or medical advice. Start your response with a friendly tone.\n\n${healthData}\n\nParent's Question: "${question}"`;

                    geminiModalContent.classList.add('hidden');
                    geminiModalLoader.classList.remove('hidden');

                    const response = await callGemini(prompt);
                    
                    document.getElementById('parent-answer-output').innerHTML = response.replace(/\n/g, '<br>');
                    document.getElementById('parent-answer-container').classList.remove('hidden');
                    
                    geminiModalLoader.classList.add('hidden');
                    geminiModalContent.classList.remove('hidden');
                });
            });

            // --- Provider "Generate Summary" Feature ---
            const generateSummaryBtn = document.getElementById('generate-summary-btn');
            const noteSummaryContainer = document.getElementById('note-summary-container');
            const noteSummaryOutput = document.getElementById('note-summary-output');

            generateSummaryBtn.addEventListener('click', async () => {
                const noteText = document.getElementById('clinical-note-input').value;
                if (!noteText) return;

                const prompt = `Summarize the following clinical encounter note into a concise bulleted list. The summary should be clear and suitable for a quick review by another healthcare professional. Note:\n\n"${noteText}"`;

                generateSummaryBtn.disabled = true;
                generateSummaryBtn.innerHTML = '<span class="mr-2">âœ¨</span> Generating...';

                const response = await callGemini(prompt);

                noteSummaryOutput.innerHTML = response.replace(/\n/g, '<br>');
                noteSummaryContainer.classList.remove('hidden');

                generateSummaryBtn.disabled = false;
                generateSummaryBtn.innerHTML = '<span class="mr-2">âœ¨</span> Generate Summary';
            });

            // --- Modal Close Logic ---
            closeGeminiModalBtn.addEventListener('click', () => {
                geminiModal.classList.add('hidden');
                geminiModalContent.classList.remove('hidden');
                geminiModalLoader.classList.add('hidden');
            });
        });
    </script>
</body>
</html>
